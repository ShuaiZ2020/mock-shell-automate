---
title: ""
format:
  docx:
    reference-doc: "C:/Users/Zhushuai/OneDrive/Work Yeedo/Other/template/shell-template.docx"
    lang: zh
  typst:
    mainfont: "SimSun"
    papersize: "presentation-16-9"
    fontsize: 10pt
    
---

```{r, include=FALSE}
knitr::opts_chunk$set(echo = F,warning = F, message = F)
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
source(paste0(Sys.getenv("USERPROFILE"),"/OneDrive/Work Yeedo/Other/Code/table_format.R"), local = knitr::knit_global())
```

```{r}
library(dplyr)
library(openxlsx) 
library(flextable)
```

```{r}
crf_field_full <- read.xlsx("../Background/ydmd_2025027_iMSC预防aGvHD的前瞻性临床研究_spec_1.0_20250427.xlsx", 
                            sheet = "Field")%>%as_tibble()
crf_dictionary_full <- read.xlsx("../Background/ydmd_2025027_iMSC预防aGvHD的前瞻性临床研究_spec_1.0_20250427.xlsx", 
                                 sheet = "DataDictionaryEntry")%>%as_tibble()
crf_module_full <- read.xlsx("../Background/ydmd_2025027_iMSC预防aGvHD的前瞻性临床研究_spec_1.0_20250427.xlsx", 
                                 sheet = "Module")%>%as_tibble()
date_format = "YYYY-MM-DD"
source(paste0(Sys.getenv("USERPROFILE"),"/OneDrive/Work Yeedo/Project/2025027/Code/shell-table-function.R"), local = knitr::knit_global())
```

::: {custom-style="SHELL-16-01-节标题2"}
受试者数据列表
:::

::: {custom-style="SHELL-16-01-节标题3"}
研究受试者
:::

::: {custom-style="SHELL-16-01-节标题3"}
方案偏离
:::

::: {custom-style="SHELL-16-01-节标题3"}
分析集汇总
:::

::: {custom-style="SHELL-16-01-节标题3"}
人口统计学和其他基线特征 
:::

::: {custom-style="SHELL-16-01-列表"}
受试者人口学资料  
全数据集
:::

```{r}
dm <- make_mock_shell(formoid = "DM", 
                row_num = 4, 
                replace_string = T,
                seed = "123",
                col_pre = c("受试者随机号", "随机组别"),
                col_combine = c("年龄", "性别", "民族")
                )

hw1 <- make_mock_shell(formoid = "HW1", 
                row_num = 4, 
                replace_string = T,
                seed = "123",
                col_pre = c()
                )
cbind(dm, hw1)%>%format_table()
footnote <- c()%>%
  add_footnote()

```
`r footnote`
`r add_saspath()`


::: {custom-style="SHELL-16-01-列表"}
病史  
全数据集
:::

```{r}
make_mock_shell(formoid = "MH2", 
                row_num = 4, 
                replace_string = F,
                seed = "123",
                col_remove = c("是否有任何其他病史？"),
                col_pre = c("受试者随机号", "随机组别", "SOC","PT"),
                col_combine = c("SOC","PT","疾病名称 （医学术语）")
                )%>%format_table()
footnote <- c(
              "SOC：系统器官分类，PT：首选术语 ",
              "依据&MedDRA.进行编码")%>%
  add_footnote()
```
`r footnote`
`r add_saspath()`

::: {custom-style="SHELL-16-01-列表"}
HCT-CI评分  
全数据集
:::

```{r}
make_mock_shell(formoid = "QRS2", 
                row_num = 4, 
                replace_string = T,
                seed = "123",
                col_remove = c("是否有任何其他病史？"),
                col_pre = c("受试者随机号", "随机组别"),
                col_combine = c()
                )%>%format_table()
footnote <- c()%>%
  add_footnote()
```
`r footnote`
`r add_saspath()`

::: {custom-style="SHELL-16-01-列表"}
心动超声  
全数据集
:::

```{r}
make_mock_shell(formoid = "TU1", 
                row_num = 4, 
                replace_string = T,
                seed = "123",
                col_remove = c(),
                col_pre = c("受试者随机号", "随机组别"),
                col_combine = c()
                )%>%format_table()
footnote <- c()%>%
  add_footnote()
```
`r footnote`
`r add_saspath()`

::: {custom-style="SHELL-16-01-列表"}
病毒检查  
全数据集
:::

```{r}
make_mock_shell(formoid = "LB10", 
                row_num = 4, 
                replace_string = T,
                seed = "123",
                col_remove = c(),
                col_pre = c("受试者随机号", "随机组别"),
                col_combine = c()
                )%>%format_table()
footnote <- c()%>%
  add_footnote()
```
`r footnote`
`r add_saspath()`


```{r}
formoid <- "LB16"
modulename <- crf_module_full%>%filter(moduleOID==formoid)%>%pull(moduleName)
population <- "全数据集"
mock_shell <- make_mock_shell(formoid = formoid, 
                row_num = 4, 
                replace_string = T,
                seed = "123",
                col_remove = c(),
                col_pre = c("受试者随机号", "随机组别"),
                col_combine = c()
                )%>%format_table()
footnote <- c()
```

::: {custom-style="SHELL-16-01-列表"}
`r modulename`  
`r population`
:::

`r mock_shell`
`r footnote%>%add_footnote()`
`r add_saspath()`

::: {custom-style="SHELL-16-01-节标题3"}
依从性
:::

```{r}
formoid <- "EX"
population <- "全数据集"
modulename <- crf_module_full%>%filter(moduleOID==formoid)%>%pull(moduleName)
mock_shell <- make_mock_shell(formoid = formoid, 
                row_num = 4, 
                replace_string = T,
                seed = "123",
                col_remove = c(),
                col_pre = c("受试者随机号", "随机组别"),
                col_combine = c(),
                filter_yes = "是否有试验用药记录？"
                )%>%format_table()
footnote <- c()
```

::: {custom-style="SHELL-16-01-列表"}
`r modulename`  
`r population`
:::

`r mock_shell`
`r footnote%>%add_footnote()`
`r add_saspath()`


```{r}
formoid <- "CM1"
population <- "全数据集"
modulename <- crf_module_full%>%filter(moduleOID==formoid)%>%pull(moduleName)
mock_shell <- make_mock_shell(formoid = formoid, 
                row_num = 4, 
                replace_string = T,
                seed = "123",
                col_remove = c(),
                col_pre = c("受试者随机号", "随机组别","ATC2", "PN"),
                col_combine = c("ATC2", "PN"),
                filter_yes = "受试者是否有合并用药？"
                )%>%format_table()
footnote <- c()%>%
  add_footnote(iswhodrug = T )
```

::: {custom-style="SHELL-16-01-列表"}
`r modulename`  
`r population`
:::

`r mock_shell`
`r footnote`
`r add_saspath()`


```{r}
formoid <- "PR1"
population <- "全数据集"
modulename <- crf_module_full%>%filter(moduleOID==formoid)%>%pull(moduleName)
mock_shell <- make_mock_shell(formoid = formoid, 
                row_num = 4, 
                replace_string = T,
                seed = "123",
                col_remove = c(),
                col_pre = c("受试者随机号", "随机组别","SOC", "PT"),
                col_combine = c("SOC", "PT","治疗名称"),
                filter_yes = "受试者在研究期间是否接受过非药物治疗？"
                )%>%format_table()

footnote <- c()%>%
  add_footnote(ismedDrug = T )
```

::: {custom-style="SHELL-16-01-列表"}
`r modulename`  
`r population`
:::

`r mock_shell`
`r footnote`
`r add_saspath()`

::: {custom-style="SHELL-16-01-节标题3"}
受试者疗效以及其他非安全性数据
:::

```{r}
formoid <- "QRS5"
population <- "全数据集"
modulename <- crf_module_full%>%filter(moduleOID==formoid)%>%pull(moduleName)
mock_shell <- make_mock_shell(formoid = formoid, 
                row_num = 4, 
                replace_string = T,
                seed = "123",
                col_remove = c(),
                col_pre = c("受试者随机号", "随机组别"),
                col_combine = c(),
                filter_yes = ""
                )%>%format_table()

footnote <- c()%>%
  add_footnote()
```

::: {custom-style="SHELL-16-01-列表"}
`r modulename`  
`r population`
:::

`r mock_shell`
`r footnote`
`r add_saspath()`


```{r}
formoid <- "QRS6"
population <- "全数据集"
modulename <- crf_module_full%>%filter(moduleOID==formoid)%>%pull(moduleName)
mock_shell <- make_mock_shell(formoid = formoid, 
                row_num = 4, 
                replace_string = T,
                seed = "123",
                col_remove = c(),
                col_pre = c("受试者随机号", "随机组别"),
                col_combine = c(),
                filter_yes = ""
                )%>%format_table()

footnote <- c()%>%
  add_footnote()
```

::: {custom-style="SHELL-16-01-列表"}
`r modulename`  
`r population`
:::

`r mock_shell`
`r footnote`
`r add_saspath()`


```{r}
formoid <- "DD"
population <- "全数据集"
modulename <- crf_module_full%>%filter(moduleOID==formoid)%>%pull(moduleName)
mock_shell <- make_mock_shell(formoid = formoid, 
                row_num = 4, 
                replace_string = T,
                seed = "123",
                col_remove = c(),
                col_pre = c("受试者随机号", "随机组别"),
                col_combine = c(),
                filter_yes = ""
                )%>%format_table()

footnote <- c()%>%
  add_footnote()
```

::: {custom-style="SHELL-16-01-列表"}
`r modulename`  
`r population`
:::

`r mock_shell`
`r footnote`
`r add_saspath()`

```{r}
formoid <- "QRS3"
population <- "全数据集"
modulename <- crf_module_full%>%filter(moduleOID==formoid)%>%pull(moduleName)
mock_shell <- make_mock_shell(formoid = formoid, 
                row_num = 4, 
                replace_string = T,
                seed = "123",
                col_remove = c(),
                col_pre = c("受试者随机号", "随机组别"),
                col_combine = c(),
                filter_yes = ""
                )%>%format_table()

footnote <- c()%>%
  add_footnote()
```

::: {custom-style="SHELL-16-01-列表"}
`r modulename`  
`r population`
:::

`r mock_shell`
`r footnote`
`r add_saspath()`

```{r}
formoid <- "QRS4"
population <- "全数据集"
modulename <- crf_module_full%>%filter(moduleOID==formoid)%>%pull(moduleName)
mock_shell <- make_mock_shell(formoid = formoid, 
                row_num = 4, 
                replace_string = T,
                seed = "123",
                col_remove = c(),
                col_pre = c("受试者随机号", "随机组别"),
                col_combine = c(),
                filter_yes = ""
                )%>%format_table()

footnote <- c()%>%
  add_footnote()
```

::: {custom-style="SHELL-16-01-列表"}
`r modulename`  
`r population`
:::

`r mock_shell`
`r footnote`
`r add_saspath()`

::: {custom-style="SHELL-16-01-节标题3"}
不良事件列表
:::

```{r}
formoid <- "AE"
population <- "安全数据集"
modulename <- crf_module_full%>%filter(moduleOID==formoid)%>%pull(moduleName)
mock_shell <- make_mock_shell(formoid = formoid, 
                row_num = 4, 
                replace_string = T,
                seed = "123",
                col_remove = c("受试者是否发生任何不良事件？"),
                col_pre = c("受试者随机号", "随机组别", "SOC","PT"),
                col_combine = c("SOC","PT"),
                filter_yes = ""
                )%>%format_table()

footnote <- c()%>%
  add_footnote(ismedDrug = T)
```

::: {custom-style="SHELL-16-01-列表"}
`r modulename`  
`r population`
:::

`r mock_shell`
`r footnote`
`r add_saspath()`


::: {custom-style="SHELL-16-01-节标题3"}
实验室指标及其他安全相关观察指标列表
:::

```{r}
formoid <- "LB1"
population <- "安全数据集"
modulename <- crf_module_full%>%filter(moduleOID==formoid)%>%pull(moduleName)
mock_shell <- make_mock_shell(formoid = formoid, 
                row_num = 4, 
                replace_string = T,
                seed = "123",
                col_remove = c("受试者是否发生任何不良事件？"),
                col_pre = c("受试者随机号", "随机组别"),
                col_combine = c(),
                filter_yes = ""
                )%>%format_table()

footnote <- c()%>%
  add_footnote()

```

::: {custom-style="SHELL-16-01-列表"}
`r modulename`  
`r population`
:::

`r mock_shell`
`r footnote`
`r add_saspath()`


```{r}
formoid <- "LB3"
population <- "安全数据集"
modulename <- crf_module_full%>%filter(moduleOID==formoid)%>%pull(moduleName)
mock_shell <- make_mock_shell(formoid = formoid, 
                row_num = 4, 
                replace_string = T,
                seed = "123",
                col_remove = c("受试者是否发生任何不良事件？"),
                col_pre = c("受试者随机号", "随机组别"),
                col_combine = c(),
                filter_yes = ""
                )%>%format_table()

footnote <- c()%>%
  add_footnote()

```

::: {custom-style="SHELL-16-01-列表"}
`r modulename`  
`r population`
:::

`r mock_shell`
`r footnote`
`r add_saspath()`

```{r}
formoid <- "LB4"
population <- "安全数据集"
modulename <- crf_module_full%>%filter(moduleOID==formoid)%>%pull(moduleName)
mock_shell <- make_mock_shell(formoid = formoid, 
                row_num = 4, 
                replace_string = T,
                seed = "123",
                col_remove = c("受试者是否发生任何不良事件？"),
                col_pre = c("受试者随机号", "随机组别"),
                col_combine = c(),
                filter_yes = ""
                )%>%format_table()

footnote <- c()%>%
  add_footnote()

```

::: {custom-style="SHELL-16-01-列表"}
`r modulename`  
`r population`
:::

`r mock_shell`
`r footnote`
`r add_saspath()`


```{r}
formoid <- "LB5"
population <- "安全数据集"
modulename <- crf_module_full%>%filter(moduleOID==formoid)%>%pull(moduleName)
mock_shell <- make_mock_shell(formoid = formoid, 
                row_num = 4, 
                replace_string = T,
                seed = "123",
                col_remove = c("受试者是否发生任何不良事件？"),
                col_pre = c("受试者随机号", "随机组别"),
                col_combine = c(),
                filter_yes = ""
                )%>%format_table()

footnote <- c()%>%
  add_footnote()
```

::: {custom-style="SHELL-16-01-列表"}
`r modulename`  
`r population`
:::

`r mock_shell`
`r footnote`
`r add_saspath()`








